# ============================================
# BOSS Cloaker - Apache .htaccess (FIXED VERSION)
# ============================================

RewriteEngine On

# Güvenlik Headerları
<IfModule mod_headers.c>
    Header set X-Content-Type-Options "nosniff"
    Header set X-XSS-Protection "1; mode=block"
</IfModule>

# Klasör listelemeyi kapat
Options -Indexes

# --------------------------------------------------------
# 1. KRİTİK DÜZELTME: Dosya ve Klasörlere Doğrudan Erişim
# --------------------------------------------------------
# Eğer istenen şey gerçek bir dosya (resim, css, js) ise dokunma, direkt aç.
RewriteCond %{REQUEST_FILENAME} -f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^ - [L]

# Eğer public veya assets klasöründen bir şey isteniyorsa izin ver
RewriteCond %{REQUEST_URI} ^/public/ [NC,OR]
RewriteCond %{REQUEST_URI} ^/assets/ [NC]
RewriteRule ^ - [L]

# --------------------------------------------------------
# 2. Hassas Dosyaları Koru
# --------------------------------------------------------
<FilesMatch "\.(env|sql|log|ini)$">
    Order Allow,Deny
    Deny from all
</FilesMatch>

<FilesMatch "^(config\.php|schema\.sql)$">
    Order Allow,Deny
    Deny from all
</FilesMatch>

# --------------------------------------------------------
# 3. Yönlendirmeler (Routing)
# --------------------------------------------------------

# Kısa linkler (r/slug) -> api/index.php'ye gider
RewriteRule ^r/([a-zA-Z0-9]+)$ api/index.php [L,QSA]

# API istekleri -> api/index.php'ye gider
RewriteRule ^api/(.*)$ api/index.php [L,QSA]

# DİĞER HER ŞEY (Admin panel vs)
# Eğer dosya bulunamadıysa ana sayfaya yönlendir (SPA Mantığı)
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^ index.php [L,QSA]
